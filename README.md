# Удаленный доступ к компьютеру с использованием технологий 80 годов

Идея проекта возникла после того, как у меня появился компьютер Электроника МС0511 (УК-НЦ):
УКНЦ - двухпроцессорная шестнадцатиразрядная ЭВМ, имеющая совмещенную шину: адрес, данные (сначала по шине передается адрес, а затем по той же шине данные).
Магистраль имеет 16 разрядов адрес/данные
Быстродействие (регистр/регистр) не менее 1 млн.оп./с.

*	ОЗУ центрального процессора 56 Кбайт (ОЗУ пользователя)
    *	ОЗУ периферийного процессора 32 Кбайт
    *	ОЗУ системное 8 Кбайт (центрального процессора)
    *	ВидеоОЗУ 96 Кбайт (три плана по 32 Кбайт)

* Количество цветов 8 (из палитры 16)

* Количество восьмицветных точек 640x288
* Масса не более 5 кг
* Потребляемая мощность не более 30 Вт

Первый процессор является центральным (КР1801ВМ2), его ресурсы:

*	В системном режиме: все адресное пространство процессора - ОЗУ, что позволяет изменять очень гибко операционную систему (ОС)
*	В режиме пользователя: - верхняя страница ОЗУ отключена, и это адресное пространство (системное ОЗУ) используется:

    *	для обмена со вторым (периферийным процессором)
    *   для работы со встроенным контроллером последовательного обмена (Стык 2- аналог RS232)
* Второй процессор называется периферийным (КР1801ВМ2), его ресурсы:
    *	ОЗУ 32 кБайта
    *   ПЗУ 32 кБайта
*	Остальное адресное пространство используется для:
    * обмена с центральным процессором
    * работы со встроенными контроллерами (дисплея, клавиатуры, таймера, магнитофона)
    * работы с внешними контроллерами, таких устройств как дисковод, винчестер, электронный диск  

## Основная часть проекта

Первая же мысль после получения машины на руки: а как соединить компьютер с внешним миром? И тут я задал вопрос на форуме, посвященном ретро ПК. Там мне ответили, что этого никто не делал, и я бросил себе вызов. В интернете нашел программу Kermit (позже я откажусь от Kermit в пользу VTCOM) для RT11-FB и драйвер XL.SYS (драйвер COM-порта).
Эта программа рассчитана на прием и передачу информации по протоколу Kermit, и в ней есть режим терминала, которым я и воспользовался. Но столкнулся с проблемой: на принимающей и передающей стороне не работали ESC-команды.
Для решения этой проблемы я пошел искать образы старых дискет с программами для компьютера, и на одной из дискет нашел файл vt200s.sav. Данный файл запускается на периферийном процессоре компьютера и эмулирует работу терминала VT200.

Чтобы осуществить подключение к другому компьютеру, я использовал nullmodem и dial-up модем, подключенный к Стык С2, функциональному аналогу RS232 (с фиксированной скоростью 9600 бод).

## Практическая часть
[Настройка терминала](https://github.com/cyberpunk2008/Terminal-from-computer-Electronics-MS0511-UKNC-/blob/main/docs/term.md)

Подключение к удаленному компьютеру по nullmodem; серверная часть — MS-DOS 7.10 и Synchronet 2.30, клиент — УК-НЦ.

![](https://github.com/cyberpunk2008/Terminal-from-computer-Electronics-MS0511-UKNC-/blob/main/docs/synchronet.png/)

## Подключение к компьютеру с операционной системой Linux с использованием платы Arduino
Для подключения я воспользовался преобразователем RS232 (Стык 2) в UART, собранным на микросхеме MAX232. Преобразователь получает на своем входе +12 вольт (логический ноль) и -12 вольт (логическая единица), а на выходе выдает +5 вольт (логическая единица) и 0 вольт (логический ноль). Преобразователь является двунаправленным.
 
Преобразователь подключен к микроконтроллеру ATmega 328P, который отправляет данные из софтверного UART в аппаратный и обратно.

Далее микроконтроллер подключен к преобразователю UART-USB, который уже подключен к компьютеру с Linux.

```
#include <SoftwareSerial.h>

SoftwareSerial softSerial(10, 11); // RX, TX пины для софтварного UART

void setup() {
  // Инициализация серийного порта
  Serial.begin(9600); // Аппаратный UART
  softSerial.begin(9600); // Софтварный UART
}

void loop() {
  // Если данные пришли на софтварный UART, отправляем их на аппаратный
  if (softSerial.available()) {
    char c = softSerial.read();
    Serial.write(c);
  }

  // Если данные пришли на аппаратный UART, отправляем их на софтварный
  if (Serial.available()) {
    char c = Serial.read();
    softSerial.write(c);
  }
}

```
![USB to UART](https://github.com/cyberpunk2008/Terminal-from-computer-Electronics-MS0511-UKNC-/blob/main/USB%20to%20UART.ino)

Настройка операционной системы Linux для того, чтобы получить доступ к консоли: я создал службу serial-getty@ttyACM0.service. Данная служба запускает agetty на порту ttyACM0 со скоростью 9600 бод в режиме эмуляции VT-200.
```
[Unit]
Description=Serial Getty on %I
After=systemd-user-sessions.service

[Service]
ExecStart=-/sbin/agetty -o'-p \\u' --keep-baud 9600 %I vt200
Type=idle
Restart=always

[Install]
WantedBy=multi-user.target
```
[](https://github.com/cyberpunk2008/Terminal-from-computer-Electronics-MS0511-UKNC-/blob/main/docs/UKNC%20to%20Linux.png)
## Запуск терминала на последовательном порту в Antix-Linux и подключение с использованием Null-Modem
Для запуска терминала на порту tty0 (COM1) нужно раскомментировать или добавить строку 

```
S0:3:respawn:/sbin/agetty ttyS0 9600 vt200
```
в файл 
```
/etc/inittab
```
![](https://github.com/cyberpunk2008/Terminal-from-computer-Electronics-MS0511-UKNC-/blob/main/docs/Antix.jpg)

## Итоги 
В процессе работы я изучил как программные, так и аппаратные аспекты терминалов. Настроил удалённый доступ в Linux-системе с использованием systemd и программы agetty.

